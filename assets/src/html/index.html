{% load staticfiles %}
{% load render_bundle from webpack_loader %}
<!DOCTYPE html>
<html>

<head>
	<title></title>
	{% render_bundle 'main' %}
</head>

<body>
	<header>
		<div id="title">Web DB App</div>
	</header>
		<div class="container">
			<div id="intro">
				<div class="timestap-container">
					<p class="timestap" id="timestamp">
					</p>
				</div>
				<h1>Dashboard</h1>
				<h2>Placeholder</h2>
				<h3>Here we should write some cool introduction.</h3>
			</div>
		</div>
		<div class="container">
			<div class="card center">
				<form action='/' method="post">
					{% csrf_token %}
					<div class="form-group">
						{{ form.daterange.errors }}
						{{ form.daterange.label_tag }}
						{{ form.daterange }}
					</div>
					<div class="form-group">
						<label for="candidates">Candidates</label>
						<div id="candidates" class="btn-group btn-group-toggle" data-toggle="buttons" role="group" aria-label="Candidates">
							<label class = "btn btn-secondary">
								<input class="form-check-input" type = "checkbox"> Option 1
							</label>
							
							<label class = "btn btn-secondary">
								<input class="form-check-input" type = "checkbox"> Option 2
							</label>
							
							<label class = "btn btn-secondary">
								<input class="form-check-input" type = "checkbox"> Option 3
							</label>
						</div>
					</div>
					<div class="form-group">
						<button type="submit" class="btn btn-primary">Submit</button>
					</div>
				<form/>
			</div>
		</div>
		<table class="container" id="corr_data">
			<script type="text/javascript">
				$.ajax({ url: '{% url "correlation_view" form.fields.start_date.initial form.fields.end_date.initial %}', 
					success: function(data) {
					document.getElementById('corr_data').innerHTML = (data); } });
			</script>
		</table>

		<div class="container">
			<canvas id="myBigChart" width="768" height="400"></canvas>
			<script type="text/javascript">
				$.get('{% url "poll_json" form.fields.start_date.initial form.fields.end_date.initial %}', 
				function(data) {
					var ctx = $("#myBigChart").get(0).getContext("2d");
					bigChart = new Chart(ctx, {
						type: 'line', data: data
					});
				});
			</script>
		</div>
		<div id="tv_heatmap">
			{{heatmap|safe}}
		</div>
	</body>


<script>
	// functionality for the date range picker
	$(function() {
		$('input[name="daterange"]').daterangepicker({
			opens: 'left'
		}, function(start, end, label) {
			onSubmitChange(start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD'))
	});
});
</script>

{% comment %} script for timestamp processing {% endcomment %}
<script>
	var currentDate = new Date().toLocaleDateString('de-DE', {
		day : 'numeric',
		month : 'short',
		year : 'numeric',
		hour: '2-digit',
		minute: '2-digit',
	});
	var ts = "Updated " + currentDate
	document.getElementById("timestamp").innerHTML = ts
	console.log(ts)
</script>


<script type="text/javascript">
	//add all other JS functions here
	//event listener for clicking submit button
	function onSubmitChange(start_date_value, end_date_value) {
		// this updates the graph
		$.ajax({
			type:"POST",
			url: '{% url "poll_json_post" %}',
			data: {'start_date': start_date_value,
				'end_date': end_date_value,
				'csrfmiddlewaretoken': '{{ csrf_token }}',
			},
			success: function(data) {
				bigChart.data = data;
				bigChart.update()
			},
		});

		// this updates the correlation matrix
		$.ajax({
			type:"POST",
			url: '{% url "correlation_view_post" %}',
			data: {'start_date': start_date_value,
				'end_date': end_date_value,
				'csrfmiddlewaretoken': '{{ csrf_token }}',
			},
			success: function(data) {
				document.getElementById('corr_data').innerHTML = (data); 
			},
		});

	};
</script>

</html>